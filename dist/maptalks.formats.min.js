/*!
 * maptalks.formats v0.3.0
 * LICENSE : BSD-3-Clause
 * (c) 2016-2021 maptalks.org
 */
/*!
 * requires maptalks@^0.25.0 
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("maptalks")):"function"==typeof define&&define.amd?define(["exports","maptalks"],t):t(e.maptalks=e.maptalks||{},e.maptalks)}(this,function(e,t){"use strict";function r(e){return new Function("d","return {"+e.map(function(e,t){return JSON.stringify(e)+": d["+t+"]"}).join(",")+"}")}function n(e,t){var n=r(e);return function(r,o){return t(n(r),o,e)}}function o(e){var t=Object.create(null),r=[];return e.forEach(function(e){for(var n in e)n in t||r.push(t[n]=n)}),r}function i(e,t){var r=l(e,t);return null===r?null:r.val}function a(e){return u(e.lat,"lat")+" "+u(e.lon,"lon")}function u(e,t){var r=s(e,t);return r.whole+"\xb0 "+(r.minutes?r.minutes+"' ":"")+(r.seconds?r.seconds+'" ':"")+r.dir}function s(e,t){var r={lat:["N","S"],lon:["E","W"]}[t]||"",n=r[e>=0?0:1],o=Math.abs(e),i=Math.floor(o),a=o-i,u=60*a,s=Math.floor(u);return{whole:i,minutes:s,seconds:Math.floor(60*(u-s)),dir:n}}function l(e,t){if(t||(t="NSEW"),"string"!=typeof e)return null;e=e.toUpperCase();var r=/^[\s\,]*([NSEW])?\s*([\-|\\u2014|\\u2015]?[0-9.]+)[\xb0\xba\u02da]?\s*(?:([0-9.]+)['\u2019\u2032\u2018]\s*)?(?:([0-9.]+)(?:''|"|\u201d|\u2033)\s*)?([NSEW])?/,n=e.match(r);if(!n)return null;var o,i=n[0];if(n[1]&&n[5]?(o=n[1],i=i.slice(0,-1)):o=n[1]||n[5],o&&-1===t.indexOf(o))return null;var a=n[2]?parseFloat(n[2]):0,u=n[3]?parseFloat(n[3])/60:0,s=n[4]?parseFloat(n[4])/3600:0,l=a<0?-1:1;return"S"!==o&&"W"!==o||(l*=-1),{val:(Math.abs(a)+u+s)*l,dim:o,matched:i,remain:e.slice(i.length)}}function c(e,t){e=e.trim();var r=l(e,t);if(!r)return null;e=r.remain.trim();var n=l(e,t);return!n||n.remain?null:r.dim?f(r.val,n.val,r.dim):[r.val,n.val]}function f(e,t,r){return"N"===r||"S"===r?[e,t]:"W"===r||"E"===r?[t,e]:void 0}function p(e,t){var r,n,o;for(var i in e)(n=i.match(t))&&(!r||n[0].length/i.length>o)&&(o=n[0].length/i.length,r=i);return r}function h(e){return p(e,ft)}function d(e){return p(e,pt)}function m(e){return!!e.match(ft)}function g(e){return!!e.match(pt)}function v(e){return"object"==(void 0===e?"undefined":ut(e))?Object.keys(e).length:0}function y(e){var t=[",",";","\t","|"],r=[];return t.forEach(function(t){var n=lt.dsvFormat(t).parse(e);if(n.length>=1){for(var o=v(n[0]),i=0;i<n.length;i++)if(v(n[i])!==o)return;r.push({delimiter:t,arity:Object.keys(n[0]).length})}}),r.length?r.sort(function(e,t){return t.arity-e.arity})[0].delimiter:null}function N(e){return delete e.columns,e}function w(e){var t=y(e);return t?N(lt.dsvFormat(t).parse(e)):null}function b(e,t,r){r||(r=t,t={}),t.delimiter=t.delimiter||",";var n=t.latfield||"",o=t.lonfield||"",i=t.crs||"",a=[],u={type:"FeatureCollection",features:a};if(""!==i&&(u.crs={type:"name",properties:{name:i}}),"auto"===t.delimiter&&"string"==typeof e&&(t.delimiter=y(e),!t.delimiter))return void r({type:"Error",message:"Could not autodetect delimiter"});var s=t.numericFields?t.numericFields.split(","):null,l="string"==typeof e?lt.dsvFormat(t.delimiter).parse(e,function(e){if(s)for(var t in e)s.includes(t)&&(e[t]=+e[t]);return e}):e;if(!l.length)return void r(null,u);var c,f=[];if(n||(n=h(l[0])),o||(o=d(l[0])),!n||!o){for(c=0;c<l.length;c++)a.push({type:"Feature",properties:l[c],geometry:null});return void r(f.length?f:null,u)}for(c=0;c<l.length;c++)if(void 0!==l[c][o]&&void 0!==l[c][n]){var p,m,g,v=l[c][o],N=l[c][n];g=ct(v,"EW"),g&&(v=g),g=ct(N,"NS"),g&&(N=g),p=parseFloat(v),m=parseFloat(N),isNaN(p)||isNaN(m)?f.push({message:"A row contained an invalid value for latitude or longitude",row:l[c],index:c}):(t.includeLatLon||(delete l[c][o],delete l[c][n]),a.push({type:"Feature",properties:l[c],geometry:{type:"Point",coordinates:[parseFloat(p),parseFloat(m)]}}))}r(f.length?f:null,u)}function x(e){for(var t=e.features,r={type:"Feature",geometry:{type:"LineString",coordinates:[]}},n=0;n<t.length;n++)r.geometry.coordinates.push(t[n].geometry.coordinates);return r.properties=t.reduce(function(e,t){for(var r in t.properties)e[r]||(e[r]=[]),e[r].push(t.properties[r]);return e},{}),{type:"FeatureCollection",features:[r]}}function E(e){for(var t=e.features,r={type:"Feature",geometry:{type:"Polygon",coordinates:[[]]}},n=0;n<t.length;n++)r.geometry.coordinates[0].push(t[n].geometry.coordinates);return r.properties=t.reduce(function(e,t){for(var r in t.properties)e[r]||(e[r]=[]),e[r].push(t.properties[r]);return e},{}),{type:"FeatureCollection",features:[r]}}function S(e){function t(e){var t=d.substring(g).match(e);return t?(g+=t[0].length,t[0]):null}function r(){t(/^\s*/)}function n(){r();for(var e,n=0,o=[],i=[o],a=o;e=t(/^(\()/)||t(/^(\))/)||t(/^(\,)/)||t(yt);){if("("===e)i.push(a),a=[],i[i.length-1].push(a),n++;else if(")"===e){if(0===a.length)return null;if(!(a=i.pop()))return null;if(0===--n)break}else if(","===e)a=[],i[i.length-1].push(a);else{if(e.split(/\s/g).some(isNaN))return null;Array.prototype.push.apply(a,e.split(/\s/g).map(parseFloat))}r()}return 0!==n?null:o}function o(){for(var e,n,o=[];n=t(yt)||t(/^(\,)/);)","===n?(o.push(e),e=[]):n.split(/\s/g).some(isNaN)||(e||(e=[]),Array.prototype.push.apply(e,n.split(/\s/g).map(parseFloat))),r();return e?(o.push(e),o.length?o:null):null}function i(){if(!t(/^(point)/i))return null;if(r(),!t(/^(\()/))return null;var e=o();return e?(r(),t(/^(\))/)?{type:"Point",coordinates:e[0]}:null):null}function a(){if(!t(/^(multipoint)/i))return null;r();var e=d.substring(d.indexOf("(")+1,d.length-1).replace(/\(/g,"").replace(/\)/g,"");d="MULTIPOINT ("+e+")";var o=n();return o?(r(),{type:"MultiPoint",coordinates:o}):null}function u(){if(!t(/^(multilinestring)/i))return null;r();var e=n();return e?(r(),{type:"MultiLineString",coordinates:e}):null}function s(){if(!t(/^(linestring)/i))return null;if(r(),!t(/^(\()/))return null;var e=o();return e&&t(/^(\))/)?{type:"LineString",coordinates:e}:null}function l(){if(!t(/^(polygon)/i))return null;r();var e=n();return e?{type:"Polygon",coordinates:e}:null}function c(){if(!t(/^(multipolygon)/i))return null;r();var e=n();return e?{type:"MultiPolygon",coordinates:e}:null}function f(){var e,n=[];if(!t(/^(geometrycollection)/i))return null;if(r(),!t(/^(\()/))return null;for(;e=p();)n.push(e),r(),t(/^(\,)/),r();return t(/^(\))/)?{type:"GeometryCollection",geometries:n}:null}function p(){return i()||s()||l()||a()||u()||c()||f()}var h=e.split(";"),d=h.pop(),m=(h.shift()||"").split("=").pop(),g=0;return function(e){return e&&m.match(/\d+/)&&(e.crs={type:"name",properties:{name:"urn:ogc:def:crs:EPSG::"+m}}),e}(p())}function T(e){function t(e){return e.join(" ")}function r(e){return e.map(t).join(", ")}function n(e){return e.map(r).map(o).join(", ")}function o(e){return"("+e+")"}switch("Feature"===e.type&&(e=e.geometry),e.type){case"Point":return"POINT ("+t(e.coordinates)+")";case"LineString":return"LINESTRING ("+r(e.coordinates)+")";case"Polygon":return"POLYGON ("+n(e.coordinates)+")";case"MultiPoint":return"MULTIPOINT ("+r(e.coordinates)+")";case"MultiPolygon":return"MULTIPOLYGON ("+function(e){return e.map(n).map(o).join(", ")}(e.coordinates)+")";case"MultiLineString":return"MULTILINESTRING ("+n(e.coordinates)+")";case"GeometryCollection":return"GEOMETRYCOLLECTION ("+e.geometries.map(T).join(", ")+")";default:throw new Error("stringify requires a valid GeoJSON Feature or geometry object as input")}}function C(e,t){return t={exports:{}},e(t,t.exports),t.exports}function D(e,t){var r=t.id,n=t.bbox,o=null==t.properties?{}:t.properties,i=A(e,t);return null==r&&null==n?{type:"Feature",properties:o,geometry:i}:null==n?{type:"Feature",id:r,properties:o,geometry:i}:{type:"Feature",id:r,bbox:n,properties:o,geometry:i}}function A(e,t){function r(e,t){t.length&&t.pop();for(var r=l[e<0?~e:e],n=0,o=r.length;n<o;++n)t.push(s(r[n],n));e<0&&xt(t,o)}function n(e){return s(e)}function o(e){for(var t=[],n=0,o=e.length;n<o;++n)r(e[n],t);return t.length<2&&t.push(t[0]),t}function i(e){for(var t=o(e);t.length<4;)t.push(t[0]);return t}function a(e){return e.map(i)}function u(e){var t,r=e.type;switch(r){case"GeometryCollection":return{type:r,geometries:e.geometries.map(u)};case"Point":t=n(e.coordinates);break;case"MultiPoint":t=e.coordinates.map(n);break;case"LineString":t=o(e.arcs);break;case"MultiLineString":t=e.arcs.map(o);break;case"Polygon":t=a(e.arcs);break;case"MultiPolygon":t=e.arcs.map(a);break;default:return null}return{type:r,coordinates:t}}var s=bt(e.transform),l=e.arcs;return u(t)}function I(){}function F(e,t,r,n,o){function i(e){if(e>65535){e-=65536;var t=55296+(e>>10),r=56320+(1023&e);return String.fromCharCode(t,r)}return String.fromCharCode(e)}function a(e){var t=e.slice(1,-1);return t in r?r[t]:"#"===t.charAt(0)?i(parseInt(t.substr(1).replace("x","0x"))):(o.error("entity not found:"+e),e)}function u(t){if(t>m){var r=e.substring(m,t).replace(/&#?\w+;/g,a);p&&s(m),n.characters(r,0,t-m),m=t}}function s(t,r){for(;t>=c&&(r=f.exec(e));)l=r.index,c=l+r[0].length,p.lineNumber++;p.columnNumber=t-l+1}for(var l=0,c=0,f=/.*(?:\r\n?|\n)|.*$/g,p=n.locator,h=[{currentNSMap:t}],d={},m=0;;){try{var g=e.indexOf("<",m);if(g<0){if(!e.substr(m).match(/^\s*$/)){var v=n.doc,y=v.createTextNode(e.substr(m));v.appendChild(y),n.currentElement=y}return}switch(g>m&&u(g),e.charAt(g+1)){case"/":var N=e.indexOf(">",g+3),w=e.substring(g+2,N),b=h.pop();N<0?(w=e.substring(g+2).replace(/[\s<].*/,""),o.error("end tag name: "+w+" is not complete:"+b.tagName),N=g+1+w.length):w.match(/\s</)&&(w=w.replace(/[\s<].*/,""),o.error("end tag name: "+w+" maybe not complete"),N=g+1+w.length);var x=b.localNSMap,E=b.tagName==w;if(E||b.tagName&&b.tagName.toLowerCase()==w.toLowerCase()){if(n.endElement(b.uri,b.localName,w),x)for(var S in x)n.endPrefixMapping(S);E||o.fatalError("end tag name: "+w+" is not match the current start tagName:"+b.tagName)}else h.push(b);N++;break;case"?":p&&s(g),N=j(e,g,n);break;case"!":p&&s(g),N=L(e,g,n,o);break;default:p&&s(g);var T=new U,C=h[h.length-1].currentNSMap,N=O(e,g,T,C,a,o),D=T.length;if(!T.closed&&k(e,N,T.tagName,d)&&(T.closed=!0,r.nbsp||o.warning("unclosed xml attribute")),p&&D){for(var A=R(p,{}),I=0;I<D;I++){var F=T[I];s(F.offset),F.locator=R(p,{})}n.locator=A,_(T,n,C)&&h.push(T),n.locator=p}else _(T,n,C)&&h.push(T);"http://www.w3.org/1999/xhtml"!==T.uri||T.closed?N++:N=M(e,N,T.tagName,a,n)}}catch(e){o.error("element parse error: "+e),N=-1}N>m?m=N:u(Math.max(g,m)+1)}}function R(e,t){return t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber,t}function O(e,t,r,n,o,i){for(var a,u,s=++t,l=At;;){var c=e.charAt(s);switch(c){case"=":if(l===It)a=e.slice(t,s),l=Rt;else{if(l!==Ft)throw new Error("attribute equal must after attrName");l=Rt}break;case"'":case'"':if(l===Rt||l===It){if(l===It&&(i.warning('attribute value must after "="'),a=e.slice(t,s)),t=s+1,!((s=e.indexOf(c,t))>0))throw new Error("attribute value no end '"+c+"' match");u=e.slice(t,s).replace(/&#?\w+;/g,o),r.add(a,u,t-1),l=_t}else{if(l!=Ot)throw new Error('attribute value must after "="');u=e.slice(t,s).replace(/&#?\w+;/g,o),r.add(a,u,t),i.warning('attribute "'+a+'" missed start quot('+c+")!!"),t=s+1,l=_t}break;case"/":switch(l){case At:r.setTagName(e.slice(t,s));case _t:case Mt:case kt:l=kt,r.closed=!0;case Ot:case It:case Ft:break;default:throw new Error("attribute invalid close char('/')")}break;case"":return i.error("unexpected end of input"),l==At&&r.setTagName(e.slice(t,s)),s;case">":switch(l){case At:r.setTagName(e.slice(t,s));case _t:case Mt:case kt:break;case Ot:case It:u=e.slice(t,s),"/"===u.slice(-1)&&(r.closed=!0,u=u.slice(0,-1));case Ft:l===Ft&&(u=a),l==Ot?(i.warning('attribute "'+u+'" missed quot(")!!'),r.add(a,u.replace(/&#?\w+;/g,o),t)):("http://www.w3.org/1999/xhtml"===n[""]&&u.match(/^(?:disabled|checked|selected)$/i)||i.warning('attribute "'+u+'" missed value!! "'+u+'" instead!!'),r.add(u,u,t));break;case Rt:throw new Error("attribute value missed!!")}return s;case"\x80":c=" ";default:if(c<=" ")switch(l){case At:r.setTagName(e.slice(t,s)),l=Mt;break;case It:a=e.slice(t,s),l=Ft;break;case Ot:var u=e.slice(t,s).replace(/&#?\w+;/g,o);i.warning('attribute "'+u+'" missed quot(")!!'),r.add(a,u,t);case _t:l=Mt}else switch(l){case Ft:r.tagName;"http://www.w3.org/1999/xhtml"===n[""]&&a.match(/^(?:disabled|checked|selected)$/i)||i.warning('attribute "'+a+'" missed value!! "'+a+'" instead2!!'),r.add(a,a,t),t=s,l=It;break;case _t:i.warning('attribute space is required"'+a+'"!!');case Mt:l=It,t=s;break;case Rt:l=Ot,t=s;break;case kt:throw new Error("elements closed character '/' and '>' must be connected to")}}s++}}function _(e,t,r){for(var n=e.tagName,o=null,i=e.length;i--;){var a=e[i],u=a.qName,s=a.value,l=u.indexOf(":");if(l>0)var c=a.prefix=u.slice(0,l),f=u.slice(l+1),p="xmlns"===c&&f;else f=u,c=null,p="xmlns"===u&&"";a.localName=f,!1!==p&&(null==o&&(o={},P(r,r={})),r[p]=o[p]=s,a.uri="http://www.w3.org/2000/xmlns/",t.startPrefixMapping(p,s))}for(var i=e.length;i--;){a=e[i];var c=a.prefix;c&&("xml"===c&&(a.uri="http://www.w3.org/XML/1998/namespace"),"xmlns"!==c&&(a.uri=r[c||""]))}var l=n.indexOf(":");l>0?(c=e.prefix=n.slice(0,l),f=e.localName=n.slice(l+1)):(c=null,f=e.localName=n);var h=e.uri=r[c||""];if(t.startElement(h,f,n,e),!e.closed)return e.currentNSMap=r,e.localNSMap=o,!0;if(t.endElement(h,f,n),o)for(c in o)t.endPrefixMapping(c)}function M(e,t,r,n,o){if(/^(?:script|textarea)$/i.test(r)){var i=e.indexOf("</"+r+">",t),a=e.substring(t+1,i);if(/[&<]/.test(a))return/^script$/i.test(r)?(o.characters(a,0,a.length),i):(a=a.replace(/&#?\w+;/g,n),o.characters(a,0,a.length),i)}return t+1}function k(e,t,r,n){var o=n[r];return null==o&&(o=e.lastIndexOf("</"+r+">"),o<t&&(o=e.lastIndexOf("</"+r)),n[r]=o),o<t}function P(e,t){for(var r in e)t[r]=e[r]}function L(e,t,r,n){switch(e.charAt(t+2)){case"-":if("-"===e.charAt(t+3)){var o=e.indexOf("--\x3e",t+4);return o>t?(r.comment(e,t+4,o-t-4),o+3):(n.error("Unclosed comment"),-1)}return-1;default:if("CDATA["==e.substr(t+3,6)){var o=e.indexOf("]]>",t+9);return r.startCDATA(),r.characters(e,t+9,o-t-9),r.endCDATA(),o+3}var i=$(e,t),a=i.length;if(a>1&&/!doctype/i.test(i[0][0])){var u=i[1][0],s=a>3&&/^public$/i.test(i[2][0])&&i[3][0],l=a>4&&i[4][0],c=i[a-1];return r.startDTD(u,s&&s.replace(/^(['"])(.*?)\1$/,"$2"),l&&l.replace(/^(['"])(.*?)\1$/,"$2")),r.endDTD(),c.index+c[0].length}}return-1}function j(e,t,r){var n=e.indexOf("?>",t);if(n){var o=e.substring(t,n).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);if(o){o[0].length;return r.processingInstruction(o[1],o[2]),n+2}return-1}return-1}function U(e){}function B(e,t){return st(e,t),e}function $(e,t){var r,n=[],o=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(o.lastIndex=t,o.exec(e);r=o.exec(e);)if(n.push(r),r[1])return n}function G(e,t){for(var r in e)t[r]=e[r]}function z(e,t){var r=e.prototype;if(Object.create){var n=Object.create(t.prototype);st(r,n)}if(!(r instanceof t)){var o=function(){};o.prototype=t.prototype,o=new o,G(r,o),e.prototype=r=o}r.constructor!=e&&("function"!=typeof e&&console.error("unknow Class:"+e),r.constructor=e)}function V(e,t){if(t instanceof Error)var r=t;else r=this,Error.call(this,Kt[e]),this.message=Kt[e],Error.captureStackTrace&&Error.captureStackTrace(this,V);return r.code=e,t&&(this.message=this.message+": "+t),r}function q(){}function H(e,t){this._node=e,this._refresh=t,X(this)}function X(e){var t=e._node._inc||e._node.ownerDocument._inc;if(e._inc!=t){var r=e._refresh(e._node);De(e,"length",r.length),G(r,e),e._inc=t}}function W(){}function Y(e,t){for(var r=e.length;r--;)if(e[r]===t)return r}function J(e,t,r,n){if(n?t[Y(t,n)]=r:t[t.length++]=r,e){r.ownerElement=e;var o=e.ownerDocument;o&&(n&&oe(o,e,n),ne(o,e,r))}}function Q(e,t,r){var n=Y(t,r);if(!(n>=0))throw V(tr,new Error(e.tagName+"@"+r));for(var o=t.length-1;n<o;)t[n]=t[++n];if(t.length=o,e){var i=e.ownerDocument;i&&(oe(i,e,r),r.ownerElement=null)}}function Z(e){if(this._features={},e)for(var t in e)this._features=e[t]}function K(){}function ee(e){return"<"==e&&"&lt;"||">"==e&&"&gt;"||"&"==e&&"&amp;"||'"'==e&&"&quot;"||"&#"+e.charCodeAt()+";"}function te(e,t){if(t(e))return!0;if(e=e.firstChild)do{if(te(e,t))return!0}while(e=e.nextSibling)}function re(){}function ne(e,t,r){e&&e._inc++,"http://www.w3.org/2000/xmlns/"==r.namespaceURI&&(t._nsMap[r.prefix?r.localName:""]=r.value)}function oe(e,t,r,n){e&&e._inc++,"http://www.w3.org/2000/xmlns/"==r.namespaceURI&&delete t._nsMap[r.prefix?r.localName:""]}function ie(e,t,r){if(e&&e._inc){e._inc++;var n=t.childNodes;if(r)n[n.length++]=r;else{for(var o=t.firstChild,i=0;o;)n[i++]=o,o=o.nextSibling;n.length=i}}}function ae(e,t){var r=t.previousSibling,n=t.nextSibling;return r?r.nextSibling=n:e.firstChild=n,n?n.previousSibling=r:e.lastChild=r,ie(e.ownerDocument,e),t}function ue(e,t,r){var n=t.parentNode;if(n&&n.removeChild(t),t.nodeType===Jt){var o=t.firstChild;if(null==o)return t;var i=t.lastChild}else o=i=t;var a=r?r.previousSibling:e.lastChild;o.previousSibling=a,i.nextSibling=r,a?a.nextSibling=o:e.firstChild=o,null==r?e.lastChild=i:r.previousSibling=i;do{o.parentNode=e}while(o!==i&&(o=o.nextSibling));return ie(e.ownerDocument||e,e),t.nodeType==Jt&&(t.firstChild=t.lastChild=null),t}function se(e,t){var r=t.parentNode;if(r){var n=e.lastChild;r.removeChild(t);var n=e.lastChild}var n=e.lastChild;return t.parentNode=e,t.previousSibling=n,t.nextSibling=null,n?n.nextSibling=t:e.firstChild=t,e.lastChild=t,ie(e.ownerDocument,e,t),t}function le(){this._nsMap={}}function ce(){}function fe(){}function pe(){}function he(){}function de(){}function me(){}function ge(){}function ve(){}function ye(){}function Ne(){}function we(){}function be(){}function xe(e,t){var r=[],n=9==this.nodeType?this.documentElement:this,o=n.prefix,i=n.namespaceURI;if(i&&null==o){var o=n.lookupPrefix(i);if(null==o)var a=[{namespace:i,prefix:null}]}return Se(this,r,e,t,a),r.join("")}function Ee(e,t,r){var n=e.prefix||"",o=e.namespaceURI;if(!n&&!o)return!1;if("xml"===n&&"http://www.w3.org/XML/1998/namespace"===o||"http://www.w3.org/2000/xmlns/"==o)return!1;for(var i=r.length;i--;){var a=r[i];if(a.prefix==n)return a.namespace!=o}return!0}function Se(e,t,r,n,o){if(n){if(!(e=n(e)))return;if("string"==typeof e)return void t.push(e)}switch(e.nodeType){case Bt:o||(o=[]);var i=(o.length,e.attributes),a=i.length,u=e.firstChild,s=e.tagName;r=jt===e.namespaceURI||r,t.push("<",s);for(var l=0;l<a;l++){var c=i.item(l);"xmlns"==c.prefix?o.push({prefix:c.localName,namespace:c.value}):"xmlns"==c.nodeName&&o.push({prefix:"",namespace:c.value})}for(var l=0;l<a;l++){var c=i.item(l);if(Ee(c,r,o)){var f=c.prefix||"",p=c.namespaceURI,h=f?" xmlns:"+f:" xmlns";t.push(h,'="',p,'"'),o.push({prefix:f,namespace:p})}Se(c,t,r,n,o)}if(Ee(e,r,o)){var f=e.prefix||"",p=e.namespaceURI,h=f?" xmlns:"+f:" xmlns";t.push(h,'="',p,'"'),o.push({prefix:f,namespace:p})}if(u||r&&!/^(?:meta|link|img|br|hr|input)$/i.test(s)){if(t.push(">"),r&&/^script$/i.test(s))for(;u;)u.data?t.push(u.data):Se(u,t,r,n,o),u=u.nextSibling;else for(;u;)Se(u,t,r,n,o),u=u.nextSibling;t.push("</",s,">")}else t.push("/>");return;case Wt:case Jt:for(var u=e.firstChild;u;)Se(u,t,r,n,o),u=u.nextSibling;return;case $t:return t.push(" ",e.name,'="',e.value.replace(/[<&"]/g,ee),'"');case Gt:return t.push(e.data.replace(/[<&]/g,ee));case zt:return t.push("<![CDATA[",e.data,"]]>");case Xt:return t.push("\x3c!--",e.data,"--\x3e");case Yt:var d=e.publicId,m=e.systemId;if(t.push("<!DOCTYPE ",e.name),d)t.push(' PUBLIC "',d),m&&"."!=m&&t.push('" "',m),t.push('">');else if(m&&"."!=m)t.push(' SYSTEM "',m,'">');else{var g=e.internalSubset;g&&t.push(" [",g,"]"),t.push(">")}return;case Ht:return t.push("<?",e.target," ",e.data,"?>");case Vt:return t.push("&",e.nodeName,";");default:t.push("??",e.nodeName)}}function Te(e,t,r){var n;switch(t.nodeType){case Bt:n=t.cloneNode(!1),n.ownerDocument=e;case Jt:break;case $t:r=!0}if(n||(n=t.cloneNode(!1)),n.ownerDocument=e,n.parentNode=null,r)for(var o=t.firstChild;o;)n.appendChild(Te(e,o,r)),o=o.nextSibling;return n}function Ce(e,t,r){var n=new t.constructor;for(var o in t){var i=t[o];"object"!=(void 0===i?"undefined":ut(i))&&i!=n[o]&&(n[o]=i)}switch(t.childNodes&&(n.childNodes=new q),n.ownerDocument=e,n.nodeType){case Bt:var a=t.attributes,u=n.attributes=new W,s=a.length;u._ownerElement=n;for(var l=0;l<s;l++)n.setAttributeNode(Ce(e,a.item(l),!0));break;case $t:r=!0}if(r)for(var c=t.firstChild;c;)n.appendChild(Ce(e,c,r)),c=c.nextSibling;return n}function De(e,t,r){e[t]=r}function Ae(e,r){return t.Ajax.get(e,function(e,t){if(e)return void r(e);var n=JSON.parse(t);r(null,n)}),this}function Ie(e,r){return t.Ajax.get(e,function(e,t){if(e)return void r(e);var n=Pe(t);r(null,n)}),this}function Fe(e,r,n){return t.Ajax.get(e,function(e,o){if(e)return void n(e);t.Util.isFunction(r)&&(n=r,r={}),Le(o,r,function(e,t){if(e)return void n(e);n(null,t)})}),this}function Re(e,r){return t.Ajax.get(e,function(e,t){if(e)return void r(e);var n=je(t);r(null,n)}),this}function Oe(e,r){return t.Ajax.get(e,function(e,t){if(e)return void r(e);var n=Ue(t);r(null,n)}),this}function _e(e,r){return t.Ajax.get(e,function(e,t){if(e)return void r(e);var n=Be(t);r(null,n)}),this}function Me(e,r){return t.Ajax.get(e,function(e,t){if(e)return void r(e);var n=lr(t);r(null,n)}),this}function ke(e,r,n){return t.Ajax.get(e,function(e,o){if(e)return void n(e);t.Util.isFunction(r)&&(n=r,r={});var i=$e(o,r);n(null,i)}),this}function Pe(e){var r=[],n="string"==typeof e?JSON.parse(e):e;for(var o in n.objects){var i=Et(n,n.objects[o]);i.features?t.Util.pushIn(r,i.features):r.push(i)}return r}function Le(e,t,r){ht.csv2geojson(e,t||{},function(e,t){return r(e,t)})}function je(e){var t=Ge(e);if(!t)throw new Error("Could not parse gpx");return sr.gpx(t)}function Ue(e){var t=Ge(e);if(!t)throw new Error("Could not parse KML");return sr.kml(t)}function Be(e){return dt(e)}function $e(e,t){t=t||{};for(var r=Nt.decode(e,t.precision),n={type:"LineString",coordinates:[]},o=0;o<r.length;o++)n.coordinates[o]=[r[o][1],r[o][0]];return n}function Ge(e){return"string"==typeof e?(new DOMParser).parseFromString(e,"text/xml"):e}var ze=function(e){function t(e,t){var o,a,u=i(e,function(e,i){if(o)return o(e,i-1);a=e,o=t?n(e,t):r(e)});return u.columns=a,u}function i(e,t){function r(){if(l>=s)return a;if(o)return o=!1,i;var t,r=l;if(34===e.charCodeAt(r)){for(var n=r;n++<s;)if(34===e.charCodeAt(n)){if(34!==e.charCodeAt(n+1))break;++n}return l=n+2,t=e.charCodeAt(n+1),13===t?(o=!0,10===e.charCodeAt(n+2)&&++l):10===t&&(o=!0),e.slice(r+1,n).replace(/""/g,'"')}for(;l<s;){var u=1;if(10===(t=e.charCodeAt(l++)))o=!0;else if(13===t)o=!0,10===e.charCodeAt(l)&&(++l,++u);else if(t!==f)continue;return e.slice(r,l-u)}return e.slice(r)}for(var n,o,i={},a={},u=[],s=e.length,l=0,c=0;(n=r())!==a;){for(var p=[];n!==i&&n!==a;)p.push(n),n=r();t&&null==(p=t(p,c++))||u.push(p)}return u}function a(t,r){return null==r&&(r=o(t)),[r.map(l).join(e)].concat(t.map(function(t){return r.map(function(e){return l(t[e])}).join(e)})).join("\n")}function u(e){return e.map(s).join("\n")}function s(t){return t.map(l).join(e)}function l(e){return null==e?"":c.test(e+="")?'"'+e.replace(/\"/g,'""')+'"':e}var c=new RegExp('["'+e+"\n]"),f=e.charCodeAt(0);return{parse:t,parseRows:i,format:a,formatRows:u}},Ve=ze(","),qe=Ve.parse,He=Ve.parseRows,Xe=Ve.format,We=Ve.formatRows,Ye=ze("\t"),Je=Ye.parse,Qe=Ye.parseRows,Ze=Ye.format,Ke=Ye.formatRows,et=Object.freeze({dsvFormat:ze,csvParse:qe,csvParseRows:He,csvFormat:Xe,csvFormatRows:We,tsvParse:Je,tsvParseRows:Qe,tsvFormat:Ze,tsvFormatRows:Ke}),tt=i,rt=c,nt=u,ot=a,it=s;tt.pair=rt,tt.format=nt,tt.formatPair=ot,tt.coordToDMS=it;var at=et&&void 0||et,ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},st=function(e,t){for(var r=Object.getOwnPropertyNames(t),n=0;n<r.length;n++){var o=r[n],i=Object.getOwnPropertyDescriptor(t,o);i&&i.configurable&&void 0===e[o]&&Object.defineProperty(e,o,i)}return e},lt=at,ct=tt,ft=/(Lat)(itude)?/gi,pt=/(L)(on|ng)(gitude)?/i,ht={isLon:g,isLat:m,guessLatHeader:h,guessLonHeader:d,csv:lt.csvParse,tsv:lt.tsvParse,dsv:lt,auto:w,csv2geojson:b,toLine:x,toPolygon:E},dt=S,mt=S,gt=T,vt=/[-+]?([0-9]*\.[0-9]+|[0-9]+)([eE][-+]?[0-9]+)?/,yt=new RegExp("^"+vt.source+"(\\s"+vt.source+"){1,}");dt.parse=mt,dt.stringify=gt;var Nt=C(function(e){function t(e){return Math.floor(Math.abs(e)+.5)*Math.sign(e)}function r(e,r,n){e=t(e*n),r=t(r*n);var o=e-r;o<<=1,e-r<0&&(o=~o);for(var i="";o>=32;)i+=String.fromCharCode(63+(32|31&o)),o>>=5;return i+=String.fromCharCode(o+63)}function n(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r].slice().reverse());return t}var o={};o.decode=function(e,t){for(var r,n,o=0,i=0,a=0,u=[],s=0,l=0,c=null,f=Math.pow(10,t||5);o<e.length;){c=null,s=0,l=0;do{c=e.charCodeAt(o++)-63,l|=(31&c)<<s,s+=5}while(c>=32);r=1&l?~(l>>1):l>>1,s=l=0;do{c=e.charCodeAt(o++)-63,l|=(31&c)<<s,s+=5}while(c>=32);n=1&l?~(l>>1):l>>1,i+=r,a+=n,u.push([i/f,a/f])}return u},o.encode=function(e,t){if(!e.length)return"";for(var n=Math.pow(10,t||5),o=r(e[0][0],0,n)+r(e[0][1],0,n),i=1;i<e.length;i++){var a=e[i],u=e[i-1];o+=r(a[0],u[0],n),o+=r(a[1],u[1],n)}return o},o.fromGeoJSON=function(e,t){if(e&&"Feature"===e.type&&(e=e.geometry),!e||"LineString"!==e.type)throw new Error("Input must be a GeoJSON LineString");return o.encode(n(e.coordinates),t)},o.toGeoJSON=function(e,t){return{type:"LineString",coordinates:n(o.decode(e,t))}},e.exports&&(e.exports=o)}),wt=function(e){return e},bt=function(e){if(null==e)return wt;var t,r,n=e.scale[0],o=e.scale[1],i=e.translate[0],a=e.translate[1];return function(e,u){u||(t=r=0);var s=2,l=e.length,c=new Array(l);for(c[0]=(t+=e[0])*n+i,c[1]=(r+=e[1])*o+a;s<l;)c[s]=e[s],++s;return c}},xt=function(e,t){for(var r,n=e.length,o=n-t;o<--n;)r=e[o],e[o++]=e[n],e[n]=r},Et=function(e,t){return"GeometryCollection"===t.type?{type:"FeatureCollection",features:t.geometries.map(function(t){return D(e,t)})}:D(e,t)},St=new ArrayBuffer(16),Tt=(new Float64Array(St),new Uint32Array(St),/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/),Ct=new RegExp("[\\-\\.0-9"+Tt.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),Dt=new RegExp("^"+Tt.source+Ct.source+"*(?::"+Tt.source+Ct.source+"*)?$"),At=0,It=1,Ft=2,Rt=3,Ot=4,_t=5,Mt=6,kt=7;I.prototype={parse:function(e,t,r){var n=this.domBuilder;n.startDocument(),P(t,t={}),F(e,t,r,n,this.errorHandler),n.endDocument()}},U.prototype={setTagName:function(e){if(!Dt.test(e))throw new Error("invalid tagName:"+e);this.tagName=e},add:function(e,t,r){if(!Dt.test(e))throw new Error("invalid attribute:"+e);this[this.length++]={qName:e,value:t,offset:r}},length:0,getLocalName:function(e){return this[e].localName},getLocator:function(e){return this[e].locator},getQName:function(e){return this[e].qName},getURI:function(e){return this[e].uri},getValue:function(e){return this[e].value}},B({},B.prototype)instanceof B||(B=function(e,t){function r(){}r.prototype=t,r=new r;for(t in e)r[t]=e[t];return r});var Pt=I,Lt={XMLReader:Pt},jt="http://www.w3.org/1999/xhtml",Ut={},Bt=Ut.ELEMENT_NODE=1,$t=Ut.ATTRIBUTE_NODE=2,Gt=Ut.TEXT_NODE=3,zt=Ut.CDATA_SECTION_NODE=4,Vt=Ut.ENTITY_REFERENCE_NODE=5,qt=Ut.ENTITY_NODE=6,Ht=Ut.PROCESSING_INSTRUCTION_NODE=7,Xt=Ut.COMMENT_NODE=8,Wt=Ut.DOCUMENT_NODE=9,Yt=Ut.DOCUMENT_TYPE_NODE=10,Jt=Ut.DOCUMENT_FRAGMENT_NODE=11,Qt=Ut.NOTATION_NODE=12,Zt={},Kt={},er=(Zt.INDEX_SIZE_ERR=(Kt[1]="Index size error",1),Zt.DOMSTRING_SIZE_ERR=(Kt[2]="DOMString size error",2),Zt.HIERARCHY_REQUEST_ERR=(Kt[3]="Hierarchy request error",3)),tr=(Zt.WRONG_DOCUMENT_ERR=(Kt[4]="Wrong document",4),Zt.INVALID_CHARACTER_ERR=(Kt[5]="Invalid character",5),Zt.NO_DATA_ALLOWED_ERR=(Kt[6]="No data allowed",6),Zt.NO_MODIFICATION_ALLOWED_ERR=(Kt[7]="No modification allowed",7),Zt.NOT_FOUND_ERR=(Kt[8]="Not found",8)),rr=(Zt.NOT_SUPPORTED_ERR=(Kt[9]="Not supported",9),Zt.INUSE_ATTRIBUTE_ERR=(Kt[10]="Attribute in use",10));Zt.INVALID_STATE_ERR=(Kt[11]="Invalid state",11),Zt.SYNTAX_ERR=(Kt[12]="Syntax error",12),Zt.INVALID_MODIFICATION_ERR=(Kt[13]="Invalid modification",13),Zt.NAMESPACE_ERR=(Kt[14]="Invalid namespace",14),Zt.INVALID_ACCESS_ERR=(Kt[15]="Invalid access",15);V.prototype=Error.prototype,G(Zt,V),q.prototype={length:0,item:function(e){return this[e]||null},toString:function(e,t){for(var r=[],n=0;n<this.length;n++)Se(this[n],r,e,t);return r.join("")}},H.prototype.item=function(e){return X(this),this[e]},z(H,q),W.prototype={length:0,item:q.prototype.item,getNamedItem:function(e){for(var t=this.length;t--;){var r=this[t];if(r.nodeName==e)return r}},setNamedItem:function(e){var t=e.ownerElement;if(t&&t!=this._ownerElement)throw new V(rr);var r=this.getNamedItem(e.nodeName);return J(this._ownerElement,this,e,r),r},setNamedItemNS:function(e){var t,r=e.ownerElement;if(r&&r!=this._ownerElement)throw new V(rr);return t=this.getNamedItemNS(e.namespaceURI,e.localName),J(this._ownerElement,this,e,t),t},removeNamedItem:function(e){var t=this.getNamedItem(e);return Q(this._ownerElement,this,t),t},removeNamedItemNS:function(e,t){var r=this.getNamedItemNS(e,t);return Q(this._ownerElement,this,r),r},getNamedItemNS:function(e,t){for(var r=this.length;r--;){var n=this[r];if(n.localName==t&&n.namespaceURI==e)return n}return null}},Z.prototype={hasFeature:function(e,t){var r=this._features[e.toLowerCase()];return!(!r||t&&!(t in r))},createDocument:function(e,t,r){var n=new re;if(n.implementation=this,n.childNodes=new q,n.doctype=r,r&&n.appendChild(r),t){var o=n.createElementNS(e,t);n.appendChild(o)}return n},createDocumentType:function(e,t,r){var n=new me;return n.name=e,n.nodeName=e,n.publicId=t,n.systemId=r,n}},K.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(e,t){return ue(this,e,t)},replaceChild:function(e,t){this.insertBefore(e,t),t&&this.removeChild(t)},removeChild:function(e){return ae(this,e)},appendChild:function(e){return this.insertBefore(e,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(e){return Ce(this.ownerDocument||this,this,e)},normalize:function(){for(var e=this.firstChild;e;){var t=e.nextSibling;t&&t.nodeType==Gt&&e.nodeType==Gt?(this.removeChild(t),e.appendData(t.data)):(e.normalize(),e=t)}},isSupported:function(e,t){return this.ownerDocument.implementation.hasFeature(e,t)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(e){for(var t=this;t;){var r=t._nsMap;if(r)for(var n in r)if(r[n]==e)return n;t=t.nodeType==$t?t.ownerDocument:t.parentNode}return null},lookupNamespaceURI:function(e){for(var t=this;t;){var r=t._nsMap;if(r&&e in r)return r[e];t=t.nodeType==$t?t.ownerDocument:t.parentNode}return null},isDefaultNamespace:function(e){return null==this.lookupPrefix(e)}},G(Ut,K),G(Ut,K.prototype),re.prototype={nodeName:"#document",nodeType:Wt,doctype:null,documentElement:null,_inc:1,insertBefore:function(e,t){if(e.nodeType==Jt){for(var r=e.firstChild;r;){var n=r.nextSibling;this.insertBefore(r,t),r=n}return e}return null==this.documentElement&&e.nodeType==Bt&&(this.documentElement=e),ue(this,e,t),e.ownerDocument=this,e},removeChild:function(e){return this.documentElement==e&&(this.documentElement=null),ae(this,e)},importNode:function(e,t){return Te(this,e,t)},getElementById:function(e){var t=null;return te(this.documentElement,function(r){if(r.nodeType==Bt&&r.getAttribute("id")==e)return t=r,!0}),t},createElement:function(e){var t=new le;return t.ownerDocument=this,t.nodeName=e,t.tagName=e,t.childNodes=new q,(t.attributes=new W)._ownerElement=t,t},createDocumentFragment:function(){var e=new Ne;return e.ownerDocument=this,e.childNodes=new q,e},createTextNode:function(e){var t=new pe;return t.ownerDocument=this,t.appendData(e),t},createComment:function(e){var t=new he;return t.ownerDocument=this,t.appendData(e),t},createCDATASection:function(e){var t=new de;return t.ownerDocument=this,t.appendData(e),t},createProcessingInstruction:function(e,t){
var r=new we;return r.ownerDocument=this,r.tagName=r.target=e,r.nodeValue=r.data=t,r},createAttribute:function(e){var t=new ce;return t.ownerDocument=this,t.name=e,t.nodeName=e,t.localName=e,t.specified=!0,t},createEntityReference:function(e){var t=new ye;return t.ownerDocument=this,t.nodeName=e,t},createElementNS:function(e,t){var r=new le,n=t.split(":"),o=r.attributes=new W;return r.childNodes=new q,r.ownerDocument=this,r.nodeName=t,r.tagName=t,r.namespaceURI=e,2==n.length?(r.prefix=n[0],r.localName=n[1]):r.localName=t,o._ownerElement=r,r},createAttributeNS:function(e,t){var r=new ce,n=t.split(":");return r.ownerDocument=this,r.nodeName=t,r.name=t,r.namespaceURI=e,r.specified=!0,2==n.length?(r.prefix=n[0],r.localName=n[1]):r.localName=t,r}},z(re,K),le.prototype={nodeType:Bt,hasAttribute:function(e){return null!=this.getAttributeNode(e)},getAttribute:function(e){var t=this.getAttributeNode(e);return t&&t.value||""},getAttributeNode:function(e){return this.attributes.getNamedItem(e)},setAttribute:function(e,t){var r=this.ownerDocument.createAttribute(e);r.value=r.nodeValue=""+t,this.setAttributeNode(r)},removeAttribute:function(e){var t=this.getAttributeNode(e);t&&this.removeAttributeNode(t)},appendChild:function(e){return e.nodeType===Jt?this.insertBefore(e,null):se(this,e)},setAttributeNode:function(e){return this.attributes.setNamedItem(e)},setAttributeNodeNS:function(e){return this.attributes.setNamedItemNS(e)},removeAttributeNode:function(e){return this.attributes.removeNamedItem(e.nodeName)},removeAttributeNS:function(e,t){var r=this.getAttributeNodeNS(e,t);r&&this.removeAttributeNode(r)},hasAttributeNS:function(e,t){return null!=this.getAttributeNodeNS(e,t)},getAttributeNS:function(e,t){var r=this.getAttributeNodeNS(e,t);return r&&r.value||""},setAttributeNS:function(e,t,r){var n=this.ownerDocument.createAttributeNS(e,t);n.value=n.nodeValue=""+r,this.setAttributeNode(n)},getAttributeNodeNS:function(e,t){return this.attributes.getNamedItemNS(e,t)},getElementsByTagName:function(e){return new H(this,function(t){var r=[];return te(t,function(n){n===t||n.nodeType!=Bt||"*"!==e&&n.tagName!=e||r.push(n)}),r})},getElementsByTagNameNS:function(e,t){return new H(this,function(r){var n=[];return te(r,function(o){o===r||o.nodeType!==Bt||"*"!==e&&o.namespaceURI!==e||"*"!==t&&o.localName!=t||n.push(o)}),n})}},re.prototype.getElementsByTagName=le.prototype.getElementsByTagName,re.prototype.getElementsByTagNameNS=le.prototype.getElementsByTagNameNS,z(le,K),ce.prototype.nodeType=$t,z(ce,K),fe.prototype={data:"",substringData:function(e,t){return this.data.substring(e,e+t)},appendData:function(e){e=this.data+e,this.nodeValue=this.data=e,this.length=e.length},insertData:function(e,t){this.replaceData(e,0,t)},appendChild:function(e){throw new Error(Kt[er])},deleteData:function(e,t){this.replaceData(e,t,"")},replaceData:function(e,t,r){r=this.data.substring(0,e)+r+this.data.substring(e+t),this.nodeValue=this.data=r,this.length=r.length}},z(fe,K),pe.prototype={nodeName:"#text",nodeType:Gt,splitText:function(e){var t=this.data,r=t.substring(e);t=t.substring(0,e),this.data=this.nodeValue=t,this.length=t.length;var n=this.ownerDocument.createTextNode(r);return this.parentNode&&this.parentNode.insertBefore(n,this.nextSibling),n}},z(pe,fe),he.prototype={nodeName:"#comment",nodeType:Xt},z(he,fe),de.prototype={nodeName:"#cdata-section",nodeType:zt},z(de,fe),me.prototype.nodeType=Yt,z(me,K),ge.prototype.nodeType=Qt,z(ge,K),ve.prototype.nodeType=qt,z(ve,K),ye.prototype.nodeType=Vt,z(ye,K),Ne.prototype.nodeName="#document-fragment",Ne.prototype.nodeType=Jt,z(Ne,K),we.prototype.nodeType=Ht,z(we,K),be.prototype.serializeToString=function(e,t,r){return xe.call(e,t,r)},K.prototype.toString=xe;try{if(Object.defineProperty){var nr=function e(t){switch(t.nodeType){case Bt:case Jt:var r=[];for(t=t.firstChild;t;)7!==t.nodeType&&8!==t.nodeType&&r.push(e(t)),t=t.nextSibling;return r.join("");default:return t.nodeValue}};Object.defineProperty(H.prototype,"length",{get:function(){return X(this),this.$$length}}),Object.defineProperty(K.prototype,"textContent",{get:function(){return nr(this)},set:function(e){switch(this.nodeType){case Bt:case Jt:for(;this.firstChild;)this.removeChild(this.firstChild);(e||String(e))&&this.appendChild(this.ownerDocument.createTextNode(e));break;default:this.data=e,this.value=e,this.nodeValue=e}}}),De=function(e,t,r){e["$$"+t]=r}}}catch(e){}var or=Z,ir=be,ar={DOMImplementation:or,XMLSerializer:ir},ur=C(function(e,t){function r(e){this.options=e||{locator:{}}}function n(e,t,r){function n(t){var n=e[t];!n&&u&&(n=2==e.length?function(r){e(t,r)}:e),i[t]=n&&function(e){n("[xmldom "+t+"]\t"+e+a(r))}||function(){}}if(!e){if(t instanceof o)return t;e=t}var i={},u=e instanceof Function;return r=r||{},n("warning"),n("error"),n("fatalError"),i}function o(){this.cdata=!1}function i(e,t){t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber}function a(e){if(e)return"\n@"+(e.systemId||"")+"#[line:"+e.lineNumber+",col:"+e.columnNumber+"]"}function u(e,t,r){return"string"==typeof e?e.substr(t,r):e.length>=t+r||t?new java.lang.String(e,t,r)+"":e}function s(e,t){e.currentElement?e.currentElement.appendChild(t):e.doc.appendChild(t)}r.prototype.parseFromString=function(e,t){var r=this.options,i=new l,a=r.domBuilder||new o,u=r.errorHandler,s=r.locator,c=r.xmlns||{},f={lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};return s&&a.setDocumentLocator(s),i.errorHandler=n(u,a,s),i.domBuilder=r.domBuilder||a,/\/x?html?$/.test(t)&&(f.nbsp="\xa0",f.copy="\xa9",c[""]="http://www.w3.org/1999/xhtml"),c.xml=c.xml||"http://www.w3.org/XML/1998/namespace",e?i.parse(e,c,f):i.errorHandler.error("invalid doc source"),a.doc},o.prototype={startDocument:function(){this.doc=(new c).createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(e,t,r,n){var o=this.doc,a=o.createElementNS(e,r||t),u=n.length;s(this,a),this.currentElement=a,this.locator&&i(this.locator,a);for(var l=0;l<u;l++){var e=n.getURI(l),c=n.getValue(l),r=n.getQName(l),f=o.createAttributeNS(e,r);this.locator&&i(n.getLocator(l),f),f.value=f.nodeValue=c,a.setAttributeNode(f)}},endElement:function(e,t,r){var n=this.currentElement;n.tagName;this.currentElement=n.parentNode},startPrefixMapping:function(e,t){},endPrefixMapping:function(e){},processingInstruction:function(e,t){var r=this.doc.createProcessingInstruction(e,t);this.locator&&i(this.locator,r),s(this,r)},ignorableWhitespace:function(e,t,r){},characters:function(e,t,r){if(e=u.apply(this,arguments)){if(this.cdata)var n=this.doc.createCDATASection(e);else var n=this.doc.createTextNode(e);this.currentElement?this.currentElement.appendChild(n):/^\s*$/.test(e)&&this.doc.appendChild(n),this.locator&&i(this.locator,n)}},skippedEntity:function(e){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(e){(this.locator=e)&&(e.lineNumber=0)},comment:function(e,t,r){e=u.apply(this,arguments);var n=this.doc.createComment(e);this.locator&&i(this.locator,n),s(this,n)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(e,t,r){var n=this.doc.implementation;if(n&&n.createDocumentType){var o=n.createDocumentType(e,t,r);this.locator&&i(this.locator,o),s(this,o)}},warning:function(e){console.warn("[xmldom warning]\t"+e,a(this.locator))},error:function(e){console.error("[xmldom error]\t"+e,a(this.locator))},fatalError:function(e){throw console.error("[xmldom fatalError]\t"+e,a(this.locator)),e}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(e){o.prototype[e]=function(){return null}});var l=Lt.XMLReader,c=t.DOMImplementation=ar.DOMImplementation;t.XMLSerializer=ar.XMLSerializer,t.DOMParser=r}),sr=C(function(e,t){var r=function(){function e(e){if(!e||!e.length)return 0;for(var t=0,r=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t)|0;return r}function t(e,t){return e.getElementsByTagName(t)}function r(e,t){return e.getAttribute(t)}function n(e,t){return parseFloat(r(e,t))}function o(e,r){var n=t(e,r);return n.length?n[0]:null}function i(e){return e.normalize&&e.normalize(),e}function a(e){for(var t=0,r=[];t<e.length;t++)r[t]=parseFloat(e[t]);return r}function u(e){return e&&i(e),e&&e.textContent||""}function s(e,t){var r,n,i={};for(n=0;n<t.length;n++)(r=o(e,t[n]))&&(i[t[n]]=u(r));return i}function l(e,t){for(var r in t)e[r]=t[r]}function c(e){return a(e.replace(g,"").split(","))}function f(e){for(var t=e.replace(v,"").split(y),r=[],n=0;n<t.length;n++)r.push(c(t[n]));return r}function p(e){var t,r=[n(e,"lon"),n(e,"lat")],i=o(e,"ele"),a=o(e,"gpxtpx:hr")||o(e,"hr"),s=o(e,"time");return i&&(t=parseFloat(u(i)),isNaN(t)||r.push(t)),{coordinates:r,time:s?u(s):null,heartRate:a?parseFloat(u(a)):null}}function h(){return{type:"FeatureCollection",features:[]}}function d(e){return void 0!==e.xml?e.xml:m.serializeToString(e)}var m,g=/\s*/g,v=/^\s*|\s*$/g,y=/\s+/;return"undefined"!=typeof XMLSerializer?m=new XMLSerializer:"object"!==("undefined"==typeof process?"undefined":ut(process))||process.browser||(m=new ur.XMLSerializer),{kml:function(n){function i(e){var t,r;return e=e||"","#"===e.substr(0,1)&&(e=e.substr(1)),6!==e.length&&3!==e.length||(t=e),8===e.length&&(r=parseInt(e.substr(0,2),16)/255,t="#"+e.substr(6,2)+e.substr(4,2)+e.substr(2,2)),[t,isNaN(r)?void 0:r]}function s(e){return a(e.split(" "))}function l(e){var r=t(e,"coord","gx"),n=[],o=[];0===r.length&&(r=t(e,"gx:coord"));for(var i=0;i<r.length;i++)n.push(s(u(r[i])));for(var a=t(e,"when"),l=0;l<a.length;l++)o.push(u(a[l]));return{coords:n,times:o}}function p(e){var r,n,i,a,s,h=[],d=[];if(o(e,"MultiGeometry"))return p(o(e,"MultiGeometry"));if(o(e,"MultiTrack"))return p(o(e,"MultiTrack"));if(o(e,"gx:MultiTrack"))return p(o(e,"gx:MultiTrack"));for(i=0;i<N.length;i++)if(n=t(e,N[i]))for(a=0;a<n.length;a++)if(r=n[a],"Point"===N[i])h.push({type:"Point",coordinates:c(u(o(r,"coordinates")))});else if("LineString"===N[i])h.push({type:"LineString",coordinates:f(u(o(r,"coordinates")))});else if("Polygon"===N[i]){var m=t(r,"LinearRing"),g=[];for(s=0;s<m.length;s++)g.push(f(u(o(m[s],"coordinates"))));h.push({type:"Polygon",coordinates:g})}else if("Track"===N[i]||"gx:Track"===N[i]){var v=l(r);h.push({type:"LineString",coordinates:v.coords}),v.times.length&&d.push(v.times)}return{geoms:h,coordTimes:d}}for(var m=h(),g={},v={},y={},N=["Polygon","LineString","Point","Track","gx:Track"],w=t(n,"Placemark"),b=t(n,"Style"),x=t(n,"StyleMap"),E=0;E<b.length;E++){var S=e(d(b[E])).toString(16);g["#"+r(b[E],"id")]=S,v[S]=b[E]}for(var T=0;T<x.length;T++){g["#"+r(x[T],"id")]=e(d(x[T])).toString(16);for(var C=t(x[T],"Pair"),D={},A=0;A<C.length;A++)D[u(o(C[A],"key"))]=u(o(C[A],"styleUrl"));y["#"+r(x[T],"id")]=D}for(var I=0;I<w.length;I++)m.features=m.features.concat(function(e){var n,a=p(e),s={},l=u(o(e,"name")),c=u(o(e,"address")),f=u(o(e,"styleUrl")),h=u(o(e,"description")),d=o(e,"TimeSpan"),m=o(e,"TimeStamp"),N=o(e,"ExtendedData"),w=o(e,"LineStyle"),b=o(e,"PolyStyle"),x=o(e,"visibility");if(!a.geoms.length)return[];if(l&&(s.name=l),c&&(s.address=c),f){"#"!==f[0]&&(f="#"+f),s.styleUrl=f,g[f]&&(s.styleHash=g[f]),y[f]&&(s.styleMapHash=y[f],s.styleHash=g[y[f].normal]);var E=v[s.styleHash];E&&(w||(w=o(E,"LineStyle")),b||(b=o(E,"PolyStyle")))}if(h&&(s.description=h),d){var S=u(o(d,"begin")),T=u(o(d,"end"));s.timespan={begin:S,end:T}}if(m&&(s.timestamp=u(o(m,"when"))),w){var C=i(u(o(w,"color"))),D=C[0],A=C[1],I=parseFloat(u(o(w,"width")));D&&(s.stroke=D),isNaN(A)||(s["stroke-opacity"]=A),isNaN(I)||(s["stroke-width"]=I)}if(b){var F=i(u(o(b,"color"))),R=F[0],O=F[1],_=u(o(b,"fill")),M=u(o(b,"outline"));R&&(s.fill=R),isNaN(O)||(s["fill-opacity"]=O),_&&(s["fill-opacity"]="1"===_?s["fill-opacity"]||1:0),M&&(s["stroke-opacity"]="1"===M?s["stroke-opacity"]||1:0)}if(N){var k=t(N,"Data"),P=t(N,"SimpleData");for(n=0;n<k.length;n++)s[k[n].getAttribute("name")]=u(o(k[n],"value"));for(n=0;n<P.length;n++)s[P[n].getAttribute("name")]=u(P[n])}x&&(s.visibility=u(x)),a.coordTimes.length&&(s.coordTimes=1===a.coordTimes.length?a.coordTimes[0]:a.coordTimes);var L={type:"Feature",geometry:1===a.geoms.length?a.geoms[0]:{type:"GeometryCollection",geometries:a.geoms},properties:s};return r(e,"id")&&(L.id=r(e,"id")),[L]}(w[I]));return m},gpx:function(e){function n(e,r){var n=t(e,r),o=[],i=[],a=[],u=n.length;if(u<2)return{};for(var s=0;s<u;s++){var l=p(n[s]);o.push(l.coordinates),l.time&&i.push(l.time),l.heartRate&&a.push(l.heartRate)}return{line:o,times:i,heartRates:a}}function i(e){var t={};if(e){var r=o(e,"line");if(r){var n=u(o(r,"color")),i=parseFloat(u(o(r,"opacity"))),a=parseFloat(u(o(r,"width")));n&&(t.stroke=n),isNaN(i)||(t["stroke-opacity"]=i),isNaN(a)||(t["stroke-width"]=96*a/25.4)}}return t}function a(e){var n=s(e,["name","cmt","desc","type","time","keywords"]),o=t(e,"link");o.length&&(n.links=[]);for(var i,a=0;a<o.length;a++)i={href:r(o[a],"href")},l(i,s(o[a],["text","type"])),n.links.push(i);return n}var c,f,d=t(e,"trk"),m=t(e,"rte"),g=t(e,"wpt"),v=h();for(c=0;c<d.length;c++)(f=function(e){for(var r,u=t(e,"trkseg"),s=[],c=[],f=[],p=0;p<u.length;p++)(r=n(u[p],"trkpt"))&&(r.line&&s.push(r.line),r.times&&r.times.length&&c.push(r.times),r.heartRates&&r.heartRates.length&&f.push(r.heartRates));if(0!==s.length){var h=a(e);return l(h,i(o(e,"extensions"))),c.length&&(h.coordTimes=1===s.length?c[0]:c),f.length&&(h.heartRates=1===s.length?f[0]:f),{type:"Feature",properties:h,geometry:{type:1===s.length?"LineString":"MultiLineString",coordinates:1===s.length?s[0]:s}}}}(d[c]))&&v.features.push(f);for(c=0;c<m.length;c++)(f=function(e){var t=n(e,"rtept");if(t.line){var r=a(e);l(r,i(o(e,"extensions")));return{type:"Feature",properties:r,geometry:{type:"LineString",coordinates:t.line}}}}(m[c]))&&v.features.push(f);for(c=0;c<g.length;c++)v.features.push(function(e){var t=a(e);return l(t,s(e,["sym"])),{type:"Feature",properties:t,geometry:{type:"Point",coordinates:p(e).coordinates}}}(g[c]));return v}}}();e.exports=r}),lr=function(e,t){function r(e){if(!e)return{};for(var r={},n=e.getElementsByTagName("tag"),o=n.length,i=0;i<o;i++)r[l(n[i],"k")]=s(l(n[i],"v"))?parseFloat(l(n[i],"v")):l(n[i],"v");return t&&(h(e,"id",r,"osm_id"),h(e,"user",r,"osm_lastEditor"),h(e,"version",r,"osm_version",!0),h(e,"changeset",r,"osm_lastChangeset",!0),h(e,"timestamp",r,"osm_lastEdited")),u(r)}function n(e,t,n){return{geometry:{type:t,coordinates:n||[]},type:"Feature",properties:r(e)}}function o(){function e(e,t){var r=l(e,"ref"),n=v[r];if(n&&"Polygon"==n.geometry.type)if(n&&"outer"==l(e,"role")){if(t.geometry.coordinates.push(n.geometry.coordinates),n.properties)for(var o in n.properties)t.properties[o]||(t.properties[o]=o)}else if(n&&"inner"==l(e,"role"))if(t.geometry.coordinates.length>1){for(var i=0;i<t.geometry.coordinates.length;i++)if(a(n.geometry.coordinates[0][0],t.geometry.coordinates[i][0])){t.geometry.coordinates[i].push(n.geometry.coordinates[0]);break}}else t.geometry.coordinates.length&&t.geometry.coordinates[0].push(n.geometry.coordinates[0]);v[r]=!1}for(var t=f(d,"relation"),r=t.length,o=[],i=0;i<r;i++){var u=n(t[i],"MultiPolygon");if("multipolygon"==u.properties.type){for(var s=f(t[i],"member"),c=0;c<s.length;c++)"outer"==l(s[c],"role")&&e(s[c],u);for(var p=0;p<s.length;p++)"inner"==l(s[p],"role")&&e(s[p],u);delete u.properties.type}u.geometry.coordinates.length&&o.push(u)}return o}function i(e){var t=[];for(var r in e)e[r]&&t.push(e[r]);return t}function a(e,t){for(var r=e[0],n=e[1],o=!1,i=0,a=t.length-1;i<t.length;a=i++){var u=t[i][0],s=t[i][1],l=t[a][0],c=t[a][1];s>n!=c>n&&r<(l-u)*(n-s)/(c-s)+u&&(o=!o)}return o}function u(e){var t,r={},n=[];for(t in e)e.hasOwnProperty(t)&&n.push(t);for(n.sort(),t=0;t<n.length;t++)r[n[t]]=e[n[t]];return r}function s(e){return!isNaN(parseFloat(e))&&isFinite(e)}function l(e,t){return e.getAttribute(t)}function c(e,t){return parseFloat(e.getAttribute(t))}function f(e,t){return e.getElementsByTagName(t)}function p(e){return[c(e,"lon"),c(e,"lat")]}function h(e,t,r,n,o){l(e,t)&&(r[n]=o?parseFloat(l(e,t)):l(e,t))}var d=function(e){return"string"!=typeof e?e:(new DOMParser).parseFromString(e,"text/xml")}(e),m={},g=function(){for(var e=f(d,"node"),t={},r=0;r<e.length;r++)t[l(e[r],"id")]=e[r];return t}(),v=function(){for(var e=f(d,"way"),t={},r=0;r<e.length;r++){var o={},i=f(e[r],"nd");o=l(i[0],"ref")===l(i[i.length-1],"ref")?n(e[r],"Polygon",[[]]):n(e[r],"LineString");for(var a=0;a<i.length;a++){var u=g[l(i[a],"ref")];if(u){var s=p(u);m[l(i[a],"ref")]=!0,"Polygon"===o.geometry.type?o.geometry.coordinates[0].push(s):o.geometry.coordinates.push(s)}}t[l(e[r],"id")]=o}return t}();return function(e,t){var r=f(t,"bounds");return r.length?(e.bbox=[c(r[0],"minlon"),c(r[0],"minlat"),c(r[0],"maxlon"),c(r[0],"maxlat")],e):e}({type:"FeatureCollection",features:[].concat(i(v)).concat(i(o)).concat(function(e){var t=[];for(var r in e){var o=f(e[r],"tag");m[r]&&!o.length||t.push(n(e[r],"Point",p(e[r])))}return t}(g))},d)},cr={geojson:Ae,topojson:Ie,csv:Fe,gpx:Re,kml:Oe,wkt:_e,polyline:ke,osm:Me};Ie.parse=Pe,Fe.parse=Le,Re.parse=je,Oe.parse=Ue,_e.parse=Be,ke.parse=$e,e.Formats=cr,Object.defineProperty(e,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("maptalks.formats v0.3.0, requires maptalks@^0.25.0.")});